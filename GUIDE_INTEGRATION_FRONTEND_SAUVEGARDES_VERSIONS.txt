# ğŸ“‹ Guide d'intÃ©gration Frontend - SystÃ¨me de Sauvegardes et Versions

## ğŸ¯ Vue d'ensemble pour le dÃ©veloppeur Frontend

### Architecture du systÃ¨me :
- **Backend** : API REST avec stockage AWS S3
- **Frontend** : Flutter avec services HTTP
- **Stockage** : Sauvegardes et versions dans le cloud AWS

---

## ğŸ“± 1. Ã‰crans Ã  crÃ©er dans Flutter

### A. Ã‰cran de gestion des sauvegardes
```
ğŸ”’ Sauvegardes
â”œâ”€â”€ ğŸ“‹ Liste des sauvegardes
â”œâ”€â”€ â• CrÃ©er une sauvegarde
â”œâ”€â”€ ğŸ“¥ TÃ©lÃ©charger une sauvegarde
â”œâ”€â”€ ğŸ”„ Restaurer une sauvegarde
â””â”€â”€ ğŸ—‘ï¸ Supprimer une sauvegarde
```

### B. Ã‰cran de gestion des versions
```
ğŸ“ Versions
â”œâ”€â”€ ğŸ“‹ Historique des versions
â”œâ”€â”€ â• CrÃ©er une version
â”œâ”€â”€ ğŸ“¥ TÃ©lÃ©charger une version
â”œâ”€â”€ ğŸ” Comparer des versions
â”œâ”€â”€ ğŸ”„ Restaurer une version
â””â”€â”€ ğŸ—‘ï¸ Supprimer une version
```

---

## ğŸ”— 2. Endpoints API Ã  utiliser

### Sauvegardes :
```http
POST   /api/sauvegardes          # CrÃ©er une sauvegarde
GET    /api/sauvegardes          # Lister les sauvegardes
GET    /api/sauvegardes/{id}     # Obtenir une sauvegarde
```

### Versions :
```http
POST   /api/versions             # CrÃ©er une version
GET    /api/versions/cible/history?cible_id=X&type=Y  # Historique
GET    /api/versions/{id}/content # Contenu d'une version
GET    /api/versions/{id}/download-url # URL de tÃ©lÃ©chargement
POST   /api/versions/compare     # Comparer deux versions
DELETE /api/versions/{id}        # Supprimer une version
```

### Restaurations :
```http
POST   /api/restaurations/backup/{id} # Restaurer une sauvegarde
GET    /api/restaurations        # Lister les restaurations
```

---

## ğŸ¨ 3. Interface utilisateur recommandÃ©e

### A. Page principale "Sauvegardes"
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”’ SAUVEGARDES                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [â• Nouvelle sauvegarde]            â”‚
â”‚                                     â”‚
â”‚ ğŸ“‹ Sauvegardes rÃ©centes :          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ“„ rapport.pdf                 â”‚ â”‚
â”‚ â”‚ ğŸ• 15/01/2024 - 14:30         â”‚ â”‚
â”‚ â”‚ ğŸ“¦ 2.5 MB                     â”‚ â”‚
â”‚ â”‚ [ğŸ“¥] [ğŸ”„] [ğŸ—‘ï¸]                â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ“ dossier_projet              â”‚ â”‚
â”‚ â”‚ ğŸ• 14/01/2024 - 09:15         â”‚ â”‚
â”‚ â”‚ ğŸ“¦ 15.2 MB                    â”‚ â”‚
â”‚ â”‚ [ğŸ“¥] [ğŸ”„] [ğŸ—‘ï¸]                â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### B. Page "Versions"
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ VERSIONS                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ SÃ©lectionner : [ğŸ“„ Fichier] [ğŸ“ Dossier] â”‚
â”‚                                     â”‚
â”‚ ğŸ“‹ Historique des versions :        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ v2.1 - 15/01/2024 16:45       â”‚ â”‚
â”‚ â”‚ "Correction finale"            â”‚ â”‚
â”‚ â”‚ [ğŸ‘ï¸] [ğŸ“¥] [ğŸ”„] [ğŸ—‘ï¸]          â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ v2.0 - 15/01/2024 14:20       â”‚ â”‚
â”‚ â”‚ "Ajout section conclusion"     â”‚ â”‚
â”‚ â”‚ [ğŸ‘ï¸] [ğŸ“¥] [ğŸ”„] [ğŸ—‘ï¸]          â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ v1.0 - 14/01/2024 10:30       â”‚ â”‚
â”‚ â”‚ "Version initiale"             â”‚ â”‚
â”‚ â”‚ [ğŸ‘ï¸] [ğŸ“¥] [ğŸ”„] [ğŸ—‘ï¸]          â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ 4. FonctionnalitÃ©s Ã  implÃ©menter

### A. CrÃ©ation de sauvegarde
- **Bouton** : "Nouvelle sauvegarde"
- **Modal** : SÃ©lectionner type (fichier/dossier/systÃ¨me)
- **Action** : Appel API `POST /api/sauvegardes`
- **Feedback** : Loading + succÃ¨s/erreur

### B. TÃ©lÃ©chargement
- **Bouton** : "ğŸ“¥ TÃ©lÃ©charger"
- **Action** : Utiliser l'URL S3 retournÃ©e
- **RÃ©sultat** : TÃ©lÃ©chargement du fichier ZIP

### C. Restauration
- **Bouton** : "ğŸ”„ Restaurer"
- **Confirmation** : "ÃŠtes-vous sÃ»r ?"
- **Action** : Appel API `POST /api/restaurations/backup/{id}`
- **Feedback** : Progression + rÃ©sultat

### D. Gestion des versions
- **SÃ©lecteur** : Type d'Ã©lÃ©ment (fichier/dossier/casier/armoire)
- **Liste** : Historique des versions
- **Actions** : Voir, tÃ©lÃ©charger, restaurer, supprimer

---

## ğŸ“Š 5. Ã‰tats et gestion d'erreurs

### Ã‰tats de chargement :
```dart
enum BackupState {
  idle,
  loading,
  success,
  error,
  uploading,
  downloading
}
```

### Messages d'erreur courants :
- "Erreur de connexion"
- "Sauvegarde en cours, veuillez patienter"
- "Fichier trop volumineux"
- "Permissions insuffisantes"

---

## ğŸ¯ 6. IntÃ©gration dans l'app existante

### Navigation :
```
Menu principal
â”œâ”€â”€ ğŸ“ Fichiers
â”œâ”€â”€ ğŸ“ Dossiers
â”œâ”€â”€ ğŸ”’ Sauvegardes â† NOUVEAU
â”œâ”€â”€ ğŸ“ Versions â† NOUVEAU
â””â”€â”€ âš™ï¸ ParamÃ¨tres
```

### Actions contextuelles :
- **Sur un fichier** : "CrÃ©er une version" / "Sauvegarder"
- **Sur un dossier** : "CrÃ©er une version" / "Sauvegarder"
- **Menu global** : "Sauvegarde systÃ¨me"

---

## ğŸ” 7. SÃ©curitÃ© et permissions

### VÃ©rifications :
- âœ… Token JWT valide
- âœ… Permissions utilisateur (admin/contributeur)
- âœ… Taille des fichiers
- âœ… Espace disponible

### Messages utilisateur :
- "Vous devez Ãªtre admin pour crÃ©er une sauvegarde systÃ¨me"
- "Espace insuffisant pour cette sauvegarde"
- "TÃ©lÃ©chargement en cours..."

---

## ğŸ“± 8. ExpÃ©rience utilisateur

### Indicateurs visuels :
- ğŸ”„ **Loading** : Pendant les opÃ©rations
- âœ… **SuccÃ¨s** : Animation de validation
- âŒ **Erreur** : Message clair
- ğŸ“Š **Progression** : Barre de progression pour les gros fichiers

### Notifications :
- "Sauvegarde crÃ©Ã©e avec succÃ¨s"
- "Version 2.1 crÃ©Ã©e"
- "Restauration terminÃ©e"
- "Erreur lors du tÃ©lÃ©chargement"

---

## ğŸš€ 9. Points d'attention

### Performance :
- âš¡ **Cache** : Mettre en cache les listes
- âš¡ **Pagination** : Pour les gros historiques
- âš¡ **Compression** : Pour les tÃ©lÃ©chargements

### UX :
- ğŸ¯ **SimplicitÃ©** : Interface intuitive
- ğŸ”„ **Feedback** : Retour immÃ©diat
- ğŸ›¡ï¸ **RÃ©cupÃ©ration** : Gestion des erreurs

---

## âœ… 10. Checklist d'implÃ©mentation

- [ ] CrÃ©er les services API
- [ ] CrÃ©er les Ã©crans UI
- [ ] ImplÃ©menter la navigation
- [ ] GÃ©rer les Ã©tats de chargement
- [ ] Ajouter la gestion d'erreurs
- [ ] Tester les fonctionnalitÃ©s
- [ ] Optimiser les performances
- [ ] Ajouter les notifications
- [ ] Documenter le code

---

## ğŸ“‹ 11. Exemples de requÃªtes API

### CrÃ©er une sauvegarde de fichier :
```json
POST /api/sauvegardes
{
  "type": "fichier",
  "cible_id": 123
}
```

### CrÃ©er une version :
```json
POST /api/versions
{
  "cible_id": 123,
  "type": "fichier",
  "description": "Correction de la section 2.1"
}
```

### Obtenir l'historique des versions :
```json
GET /api/versions/cible/history?cible_id=123&type=fichier
```

### Restaurer une sauvegarde :
```json
POST /api/restaurations/backup/backup-id-123
```

---

## ğŸ”— 12. RÃ©ponses API attendues

### Sauvegarde crÃ©Ã©e :
```json
{
  "message": "Sauvegarde de type fichier crÃ©Ã©e avec succÃ¨s.",
  "backup": {
    "id": 1,
    "type": "fichier",
    "chemin_sauvegarde": "https://arkiva-storage.s3.amazonaws.com/uploads/backups/fichier_123_1703123456789.zip",
    "contenu_json": {
      "s3Key": "uploads/backups/fichier_123_1703123456789.zip",
      "s3Size": 1024
    }
  },
  "s3Location": "https://arkiva-storage.s3.amazonaws.com/uploads/backups/fichier_123_1703123456789.zip"
}
```

### Version crÃ©Ã©e :
```json
{
  "id": "uuid-version-1",
  "cible_id": 123,
  "type": "fichier",
  "version_number": "1.0",
  "storage_path": "uploads/versions/123/uuid-version-1_content",
  "metadata": {
    "s3Location": "https://arkiva-storage.s3.amazonaws.com/uploads/versions/123/uuid-version-1_content",
    "s3Size": 512
  }
}
```

---

## ğŸ¯ 13. DiffÃ©rence entre Versions et Sauvegardes

### VERSIONS - Historique des modifications
- **Objectif** : Garder un historique des modifications d'un Ã©lÃ©ment
- **FrÃ©quence** : Automatique ou manuelle Ã  chaque modification
- **GranularitÃ©** : Par Ã©lÃ©ment (fichier, dossier, casier, armoire)
- **RÃ©tention** : Long terme, pour l'historique complet

### SAUVEGARDES - Protection contre la perte
- **Objectif** : Protection contre la perte de donnÃ©es
- **FrÃ©quence** : PlanifiÃ©e (quotidienne, hebdomadaire, mensuelle)
- **GranularitÃ©** : Par Ã©lÃ©ment OU systÃ¨me complet
- **RÃ©tention** : Selon politique de sauvegarde

### Comparaison :
| Aspect | VERSIONS | SAUVEGARDES |
|--------|----------|-------------|
| **Objectif** | Historique des modifications | Protection contre la perte |
| **DÃ©clenchement** | Automatique lors des modifications | Manuel ou planifiÃ© |
| **Contenu** | Juste le contenu modifiÃ© | Archive complÃ¨te |
| **Compression** | Non | Oui (ZIP) |
| **RÃ©cupÃ©ration** | Restauration d'une version spÃ©cifique | Restauration complÃ¨te |
| **Espace** | OptimisÃ© | Plus volumineux |
| **FrÃ©quence** | Ã€ chaque modification | Selon planning |

---

## ğŸš€ 14. Conseils d'implÃ©mentation

1. **Commencez par les sauvegardes** : Plus simple Ã  implÃ©menter
2. **Ajoutez les versions ensuite** : Plus complexe mais plus utile
3. **Testez avec de petits fichiers** : Pour valider le flux
4. **ImplÃ©mentez la gestion d'erreurs** : Essentiel pour l'UX
5. **Ajoutez des indicateurs de progression** : Pour les gros fichiers
6. **Optimisez les performances** : Cache et pagination
7. **Documentez le code** : Pour la maintenance

---

**Le dÃ©veloppeur frontend a maintenant toutes les informations pour intÃ©grer le systÃ¨me de sauvegardes et versions dans l'application Flutter.** ğŸš€ 